# <!-- Powered by BMADâ„¢ Core -->
Status: Ready for Review

**As a** SRE team member,
**I want** to containerize and deploy the k8s-agent service,
**so that** it can be managed and run in a Kubernetes cluster.

### Acceptance Criteria
1. A `Dockerfile` is created in the `services/k8s-agent` directory.
2. The `Dockerfile` produces a runnable container image for the k8s-agent application.
3. The `charts/sre-orchestrator/values.yaml` file is updated to include configuration for the k8s-agent.
4. A new `deployment-k8s-agent.yaml` is created in `charts/sre-orchestrator/templates/` to manage the k8s-agent deployment.
5. A new `service-k8s-agent.yaml` is created in `charts/sre-orchestrator/templates/` to expose the k8s-agent service.
6. The Helm chart can be successfully deployed with the new k8s-agent service.

### Tasks / Subtasks
- [x] **Task 1: Create Dockerfile for k8s-agent** (AC: #1, #2)
  - [x] Create a multi-stage `Dockerfile` in `services/k8s-agent/`.
  - [x] Ensure the `Dockerfile` correctly installs dependencies and copies the application code.
  - [x] Verify that the container image can be built successfully.
- [x] **Task 2: Update Helm Chart for k8s-agent** (AC: #3, #4, #5, #6)
  - [x] Add a new section for `k8sAgent` to `charts/sre-orchestrator/values.yaml`.
  - [x] Create `charts/sre-orchestrator/templates/deployment-k8s-agent.yaml`.
  - [x] Create `charts/sre-orchestrator/templates/service-k8s-agent.yaml`.
  - [x] Create `charts/sre-orchestrator/templates/rbac-k8s-agent.yaml` to define a Role and RoleBinding for the.
  - [x] Ensure the Helm chart is installable and the `k8s-agent` deploys correctly.

### Dev Notes
- The `k8s-agent` is a FastAPI application that requires permissions to get, list, and watch pods in the cluster.
- The Helm chart should allow for configuration of the `k8s-agent` image, replica count, and service properties.
- The service account for the `k8s-agent` should be named `sre-orchestrator-k8s-agent`.
- The container image should be named `sre-orchestrator/k8s-agent` and the tag should be based on the application version.
- Default resource requests and limits should be defined in the `values.yaml` file (e.g., CPU: 100m, Memory: 128Mi).

### Testing
- The `Dockerfile` should be tested by building the image locally.
- The Helm chart changes should be tested by deploying the chart to a local or development Kubernetes cluster.
- The RBAC rules should be tested by verifying that the deployed agent can access pod information.

### Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025--09-25 | 1.0 | Initial draft | Bob (Scrum Master) |
| 2025-09-25 | 1.1 | Added RBAC tasks and expanded Dev Notes | Sarah (Product Owner) |

### Dev Agent Record
#### Agent Model Used
{{agent_model_name_version}}

#### Debug Log References

#### Completion Notes List
- Created Dockerfile for the k8s-agent service.
- Updated the Helm chart to include the k8s-agent deployment, service, and RBAC roles.
- Manually verified Helm chart functionality as per user request.
- Successfully built the k8s-agent Docker image.

#### File List
- `services/k8s-agent/Dockerfile`
- `charts/sre-orchestrator/values.yaml`
- `charts/sre-orchestrator/templates/deployment-k8s-agent.yaml`
- `charts/sre-orchestrator/templates/service-k8s-agent.yaml`
- `charts/sre-orchestrator/templates/rbac-k8s-agent.yaml`

### QA Results
