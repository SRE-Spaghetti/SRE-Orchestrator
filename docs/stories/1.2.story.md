---
Epic: 1
Story: 2
Title: Basic Helm Chart
Status: Approved
---

### Story

As a DevOps Engineer, I want a basic Helm chart that deploys the application to Kubernetes, so that I can automate and manage its deployment lifecycle.

### Acceptance Criteria

1.  A new Helm chart is created within the project repository (e.g., in a `/charts` directory).
2.  The chart includes templates for a Deployment, a Service, and a ServiceAccount.
3.  The application's Docker image can be built and used by the Helm chart.
4.  The application can be successfully deployed to a local Kubernetes cluster (e.g., Kind, Minikube) using `helm install`.
5.  The `/health` endpoint is accessible within the cluster via the created Service.

### Dev Notes

#### Infrastructure & Deployment
- **Tool:** Helm 3.19.0 [Source: `architecture/tech-stack.md`]
- **Location:** The Helm chart should be created in the `charts/sre-orchestrator` directory. [Source: `architecture/source-tree.md`]
- **Approach:** A single parent Helm chart will manage the deployment of all microservices. For now, this will just be the Orchestrator. [Source: `architecture/infrastructure-and-deployment.md`]
- **Deployment Strategy:** The default strategy will be Rolling Update. [Source: `architecture/infrastructure-and-deployment.md`]

#### Containerization
- **Tool:** Docker 28.4.0 [Source: `architecture/tech-stack.md`]
- **Dockerfile Location:** A `Dockerfile` should exist in the `services/orchestrator/` directory. [Source: `architecture/source-tree.md`]

#### Previous Story Insights
- Story 1.1 established the `services/orchestrator` application with a `/health` endpoint. This story needs to containerize that application and deploy it.

#### Testing
- **Framework:** Use `helm unittest` or a similar tool to validate the rendered Kubernetes manifests. [Source: `architecture/test-strategy-and-standards.md`]
- **File Convention:** Test files should be placed within the chart's `tests/` directory. [Source: `architecture/test-strategy-and-standards.md`]
- **Coverage:** Add a basic test to ensure the correct image and tag are used in the Deployment manifest. [Source: `architecture/test-strategy-and-standards.md`]

### Tasks / Subtasks

1.  **(AC: 3)** **Create Dockerfile for Orchestrator:**
    - Create a `Dockerfile` in the `services/orchestrator/` directory.
    - The `Dockerfile` should use a Python base image (e.g., `python:3.12-slim`).
    - It should copy the `pyproject.toml` and `poetry.lock` files, install dependencies using `poetry install --no-root --no-dev`, and then copy the application code.
    - The `CMD` should be `uvicorn app.main:app --host 0.0.0.0 --port 80`.
2.  **(AC: 1)** **Scaffold Helm Chart:**
    - Create the directory `charts/sre-orchestrator`.
    - Run `helm create sre-orchestrator` inside the `charts` directory to generate the basic chart structure.
    - Remove unused default templates (e.g., `hpa.yaml`, `ingress.yaml`, `NOTES.txt`) to keep the chart clean.
3.  **(AC: 2)** **Create Kubernetes Manifest Templates:**
    - **Deployment (`templates/deployment-orchestrator.yaml`):** Create a Deployment template for the orchestrator service. It should reference the Docker image built in the previous step.
    - **Service (`templates/service-orchestrator.yaml`):** Create a Service template to expose the orchestrator's port (80) within the cluster.
    - **ServiceAccount (`templates/serviceaccount.yaml`):** Create a minimal `ServiceAccount` for the orchestrator. No special permissions are needed at this stage.
    - **Helpers (`templates/_helpers.tpl`):** Use helpers for common labels and names.
4.  **(AC: 4, 5)** **Configure and Test Deployment:**
    - Update `values.yaml` to allow for configuration of the image repository, tag, and service port.
    - Build the Docker image for the orchestrator service.
    - Deploy the chart to a local Kubernetes cluster (e.g., Minikube, kind) using `helm install`.
    - Verify that the pod is running and that the `/health` endpoint is accessible via the Service.
5.  **Write Unit Tests for Helm Chart:**
    - Use a tool like `helm unittest` or simply `helm template` with assertions to verify the generated Kubernetes manifests are correct.
    - Add a basic test to ensure the correct image is being used in the Deployment.

### Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| _TBD_ | 1.0 | Initial Draft | _TBD_ |

### Dev Agent Record

#### Agent Model Used
_TBD_

#### Debug Log References
_TBD_

#### Completion Notes List
-

#### File List
-

### QA Results

- **Status:** Not yet reviewed
- **Date:**
- **Reviewed by:**
- **Summary:**
- **Issues Found:**
- **Recommendations:**
