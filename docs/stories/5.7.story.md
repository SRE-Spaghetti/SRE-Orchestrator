---
Epic: 5
Story: 7
Title: Implement CLI Application
Status: Done
---

### Story

As an SRE, I want an interactive command-line interface to interact with the orchestrator using natural language, so that I can easily investigate incidents without writing API requests.

### Acceptance Criteria

1. A CLI project structure is created in the `cli/` directory
2. The CLI provides an interactive REPL-style chat interface
3. The CLI can create incidents and display investigation results
4. The CLI supports commands: chat, investigate, list, show, config
5. The CLI displays formatted output with syntax highlighting
6. The CLI can be configured via command-line arguments and config file
7. The CLI is packaged and installable via pip/pipx

### Dev Notes

#### Project Structure
```
cli/
├── pyproject.toml           # CLI package configuration
├── README.md                # CLI usage documentation
└── src/
    └── sre_orchestrator_cli/
        ├── __init__.py
        ├── main.py          # Entry point with argument parsing
        ├── client.py        # Orchestrator API client
        ├── ui.py            # Terminal UI and formatting
        └── session.py       # Session management and history
```
[Source: `.kiro/specs/orchestrator-refactoring/design.md` Section 4]

#### API Client Interface
```python
class OrchestratorClient:
    def __init__(self, base_url: str, api_key: Optional[str] = None)

    async def create_incident(self, description: str) -> str:
        """Create incident and return incident_id"""

    async def get_incident(self, incident_id: str) -> Incident:
        """Get incident details"""

    async def stream_incident_progress(self, incident_id: str) -> AsyncIterator[str]:
        """Stream investigation progress (future enhancement)"""

    async def list_incidents(self, limit: int = 10) -> List[Incident]:
        """List recent incidents"""
```
[Source: `.kiro/specs/orchestrator-refactoring/design.md` Section 4]

#### CLI Commands
```bash
# Interactive mode
sre-orchestrator chat

# One-shot investigation
sre-orchestrator investigate "Pod auth-service-xyz is crashing"

# List incidents
sre-orchestrator list

# View incident details
sre-orchestrator show <incident-id>

# Configuration
sre-orchestrator config set orchestrator-url http://localhost:8000
```
[Source: `.kiro/specs/orchestrator-refactoring/design.md` Section 4]

#### Key Features
- Interactive REPL-style interface
- Syntax highlighting for logs and JSON using `rich` library
- Progress indicators for long-running investigations
- Command history and autocomplete
- Configuration file support (~/.sre-orchestrator/config.yaml)
[Source: `.kiro/specs/orchestrator-refactoring/design.md` Section 4]

#### Configuration Management
- Config file location: `~/.sre-orchestrator/config.yaml`
- Support environment variables for configuration
- Config file permissions: 0600 (secure)
- Store: orchestrator URL, API key
[Source: `.kiro/specs/orchestrator-refactoring/tasks.md` Task 7.5]

#### Dependencies
- `click` or `typer` for command-line argument parsing
- `rich` for terminal formatting and syntax highlighting
- `httpx` for async HTTP requests
- `pyyaml` for config file handling
[Source: `.kiro/specs/orchestrator-refactoring/design.md` Section 4]

### Tasks / Subtasks

- [x] **(AC: 1)** **Create CLI Project Structure:**
  - Create `cli/` directory in project root
  - Create `cli/pyproject.toml` for CLI package
  - Create `cli/src/sre_orchestrator_cli/` package structure
  - Add main.py, client.py, ui.py, session.py modules

- [x] **(AC: 3)** **Implement Orchestrator API Client:**
  - Create `OrchestratorClient` class in client.py
  - Implement `create_incident()` method
  - Implement `get_incident()` method
  - Implement `list_incidents()` method
  - Add error handling for API calls
  - Support authentication via API key

- [x] **(AC: 2, 5)** **Implement Interactive CLI Interface:**
  - Create interactive REPL in ui.py
  - Add syntax highlighting for logs and JSON using `rich` library
  - Implement progress indicators for investigations
  - Add command history support
  - Format incident results for terminal display

- [x] **(AC: 4)** **Implement CLI Commands:**
  - Implement 'chat' command for interactive mode
  - Implement 'investigate' command for one-shot investigations
  - Implement 'list' command for listing incidents
  - Implement 'show' command for viewing incident details
  - Implement 'config' command for configuration management
  - Add argument parsing with click or typer

- [x] **(AC: 6)** **Add CLI Configuration Management:**
  - Create config file support (~/.sre-orchestrator/config.yaml)
  - Support environment variables for configuration
  - Implement config set/get commands
  - Store orchestrator URL and API key securely (0600 permissions)

- [x] **(AC: 7)** **Package CLI for Distribution:**
  - Configure pyproject.toml with entry points
  - Add CLI installation instructions to README
  - Test installation with pip and pipx
  - Document all commands and options

- [x] **Write Integration Tests:**
  - Test CLI commands with mock orchestrator API
  - Test interactive mode
  - Test configuration management
  - Test error handling

- [x] **Create Git Commit:**
  - Commit message: "feat: implement interactive CLI for SRE Orchestrator"
  - Include all CLI application files
  - Never use "git add -A"

### Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-11-14 | 1.0 | Initial draft | Yi (Dev) |

### Dev Agent Record

#### Agent Model Used
_TBD_

#### Debug Log References
_TBD_

#### Completion Notes List
-

#### File List
-

### QA Results

- **Status:** Not yet reviewed
- **Date:**
- **Reviewed by:**
- **Summary:**
- **Issues Found:**
- **Recommendations:**
