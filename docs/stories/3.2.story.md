---
Epic: 3
Story: 2
Title: Static Knowledge Graph Implementation
Status: Ready for Review
---

### Story

As the Orchestrator, I want to load a simple, file-based knowledge graph on startup, so that I have a basic understanding of the application's components and their relationships.

### Acceptance Criteria

1.  A YAML or JSON file is created in the repository to represent the knowledge graph (e.g., `knowledge_graph.yaml`).
2.  The file defines a simple schema with `components` (e.g., services, databases) and their `relationships` (e.g., `depends_on`).
3.  The orchestrator service parses this file on startup and loads the graph into an in-memory data structure.
4.  The orchestrator can perform a basic query on the graph, such as "find all components that component X depends on."

### Dev Notes

#### Knowledge Graph Details
- **Format:** YAML [Source: `architecture/tech-stack.md`]
- **Location:** The file should be created at the project root as `knowledge_graph.yaml`. [Source: `architecture/source-tree.md`]
- **Schema:** The YAML should have a top-level `components` key. Each component should have a name, a type, and an optional `relationships` key which can contain a list of `depends_on` targets.
  ```yaml
  components:
    - name: orchestrator-service
      type: service
      relationships:
        - depends_on: k8s-agent
    - name: k8s-agent
      type: service
  ```

#### Project Structure
- **Service:** Create a new service at `services/orchestrator/app/services/knowledge_graph_service.py`. This service should be responsible for loading, parsing, and querying the graph.
- **Loading:** The service should be initialized and the graph loaded during the FastAPI application's startup event. A singleton pattern should be used to ensure the graph is loaded only once.

#### Testing
- **Framework:** `pytest` [Source: `architecture/test-strategy-and-standards.md`]
- **Location:** `services/orchestrator/tests/unit/` [Source: `architecture/test-strategy-and-standards.md`]
- **Coverage:** Unit tests should verify that the YAML file is parsed correctly and that the query method returns the expected dependencies. [Source: `architecture/test-strategy-and-standards.md`]

### Tasks / Subtasks

1.  [x] **(AC: 1, 2) Create Knowledge Graph File:**
    - Create `knowledge_graph.yaml` in the project root.
    - Populate it with a few sample components based on the defined schema, representing the orchestrator and k8s-agent.
2.  [x] **Define Pydantic Models:**
    - In `services/orchestrator/app/models/`, create Pydantic models to represent the structure of the `knowledge_graph.yaml` file (e.g., `Component`, `Relationship`, `KnowledgeGraph`).
3.  [x] **(AC: 3, 4) Create Knowledge Graph Service:**
    - Create the file `services/orchestrator/app/services/knowledge_graph_service.py`.
    - Add `PyYAML` to the orchestrator's `pyproject.toml`.
    - Implement a `KnowledgeGraphService` class.
    - The service's `__init__` should load and parse the YAML file into the Pydantic models.
    - Implement a query method, e.g., `get_dependencies(component_name: str) -> list[str]`.
4.  [x] **Integrate into Application Startup:**
    - In `services/orchestrator/app/main.py`, use FastAPI's `@app.on_event("startup")` decorator.
    - In the startup event handler, create an instance of the `KnowledgeGraphService` and attach it to the app state, making it available for dependency injection.
5.  [x] **Write Unit Tests:**
    - In `services/orchestrator/tests/unit/`, create a new test file for the `KnowledgeGraphService`.
    - Write tests to verify that the YAML file is parsed correctly.
    - Write tests for the query method to ensure it returns the correct dependencies for a given component.

### Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| _TBD_ | 1.0 | Initial Draft | _TBD_ |

### Dev Agent Record

#### Agent Model Used
_TBD_

#### Debug Log References
_TBD_

#### Completion Notes List
-

#### File List
- knowledge_graph.yaml
- services/orchestrator/src/app/models/knowledge_graph.py
- services/orchestrator/src/app/services/knowledge_graph_service.py
- services/orchestrator/src/app/main.py
- services/orchestrator/src/tests/unit/test_knowledge_graph_service.py

### QA Results

- **Status:** Not yet reviewed
- **Date:**
- **Reviewed by:**
- **Summary:**
- **Issues Found:**
- **Recommendations:**
