---
Epic: 2
Story: 2
Title: Retrieve Pod Details
Status: Draft
---

### Story

As the Orchestrator, I want to request the detailed status and configuration of a specific pod from the Kubernetes Agent, so that I can gather basic diagnostic information.

### Acceptance Criteria

1.  The Kubernetes Agent exposes an internal API endpoint (`GET /api/v1/pods/{namespace}/{name}`).
2.  When called, the agent uses the Kubernetes API to fetch the full Pod resource for the specified pod.
3.  The agent extracts and returns a simplified JSON object containing key details: status (e.g., `Running`, `Pending`, `Failed`), container statuses, restart counts, and resource limits/requests.
4.  If the pod is not found, the agent returns a `404 Not Found` error.

### Dev Notes

#### API Specifications
- **Endpoint:** `GET /api/v1/pods/{namespace}/{name}` [Source: `architecture/components.md`]
- **Path Parameters:** `namespace` (string), `name` (string)
- **Success Response (200 OK):** A JSON object with a structure like:
  ```json
  {
    "status": "Running",
    "restart_count": 2,
    "container_statuses": [
      {
        "name": "main-app",
        "state": "running",
        "ready": true
      }
    ],
    "resource_limits": {
      "cpu": "500m",
      "memory": "256Mi"
    },
    "resource_requests": {
      "cpu": "250m",
      "memory": "128Mi"
    }
  }
  ```
- **Error Response (404 Not Found):** Standard FastAPI 404 response.

#### Project Structure
- **API Endpoint:** Implement in a new router under `services/k8s-agent/app/api/v1/`.
- **Pydantic Models:** Define the response model in `services/k8s-agent/app/models/`.
- **Core Logic:** The logic for interacting with the Kubernetes API should be in the `k8s_client` service created in Story 2.1 (`services/k8s-agent/app/services/`).

#### Previous Story Insights
- This story builds on the `k8s-agent` service foundation from Story 2.1. The Kubernetes client initialized in that story should be used here.

### Tasks / Subtasks

1.  **(AC: 3)** **Define Pydantic Models:**
    - In `services/k8s-agent/app/models/`, create Pydantic models to represent the simplified pod details response body. You will likely need nested models for container statuses and resource requests/limits.
2.  **(AC: 2, 4)** **Extend Kubernetes Client Service:**
    - In `services/k8s-agent/app/services/k8s_client.py`, create a new method `get_pod_details(namespace: str, name: str)`.
    - This method should use the initialized Kubernetes client (`core_v1_api`) to call `read_namespaced_pod`.
    - Wrap the API call in a `try...except` block to catch `kubernetes.client.ApiException` with a status of 404, returning `None` in that case.
    - If the pod is found, parse the complex `V1Pod` object and map its data to your simplified Pydantic response model.
3.  **(AC: 1)** **Implement API Endpoint:**
    - In `services/k8s-agent/app/api/v1/`, create a new router for pods.
    - Implement the `GET /api/v1/pods/{namespace}/{name}` endpoint.
    - Use FastAPI's dependency injection to get the Kubernetes client service.
    - Call the `get_pod_details` method.
    - If details are returned, respond with 200 OK. If `None` is returned, raise a `404 HTTPException`.
4.  **Write Unit Tests:**
    - In `services/k8s-agent/tests/unit/`, create a new test file for the pods API.
    - Write a test that mocks the `k8s_client` service.
    - Test the success case: when the service returns pod data, the endpoint returns 200 OK with the correct payload.
    - Test the failure case: when the service returns `None`, the endpoint returns 404 Not Found.

### QA Results

- **Status:** Not yet reviewed
- **Date:**
- **Reviewed by:**
- **Summary:**
- **Issues Found:**
- **Recommendations:**
