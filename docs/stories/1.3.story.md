---
Epic: 1
Story: 3
Title: Incident Creation API Endpoint
Status: Approved
---

### Story

As an SRE, I want to create a new incident investigation by sending a `POST` request to `/api/v1/incidents`, so that I can programmatically trigger the diagnostic process.

### Acceptance Criteria

1.  A `POST /api/v1/incidents` endpoint is implemented.
2.  The endpoint accepts a JSON payload containing at least a `description` field (e.g., `{"description": "Pod 'auth-service-xyz' is in CrashLoopBackOff"}`).
3.  Upon receiving a valid request, the endpoint returns a `202 Accepted` status code.
4.  The response body is a JSON object containing a unique, system-generated `incident_id`.
5.  The new incident (with its ID, description, and an initial status of "pending") is stored in a simple in-memory data store for now.

### Dev Notes

#### API Specifications
- **Endpoint:** `POST /api/v1/incidents`
- **Request Body Schema (`NewIncidentRequest`):**
  ```json
  {
    "description": "string"
  }
  ```
- **Success Response (`NewIncidentResponse`):**
  - **Status Code:** 202 Accepted
  - **Body:**
    ```json
    {
      "incident_id": "string (uuid)"
    }
    ```
  [Source: `architecture/rest-api-spec.md`]

#### Data Models & Storage
- **Data Model (`Incident`):** The incident should be stored using the `Incident` model, including `id`, `description`, `status`, and `created_at`. [Source: `architecture/data-models.md`]
- **Storage:** For the MVP, incidents will be stored in a simple in-memory Python dictionary. A repository pattern should be used to abstract this. [Source: `architecture/high-level-architecture.md`, `architecture/database-schema.md`]

#### Project Structure
- **API Endpoint:** The new endpoint should be implemented in a new file within `services/orchestrator/app/api/v1/`. [Source: `architecture/source-tree.md`]
- **Pydantic Models:** The request and response models should be defined in `services/orchestrator/app/models/`. [Source: `architecture/source-tree.md`]
- **Core Logic:** The logic for creating and storing the incident should be in a new service or repository class under `services/orchestrator/app/core/`. [Source: `architecture/source-tree.md`]

#### Coding Standards
- Use Pydantic models for request body validation. [Source: `architecture/coding-standards.md`]
- Use FastAPI's dependency injection to provide the incident repository/service to the API endpoint. [Source: `architecture/coding-standards.md`]

#### Testing
- **Framework:** `pytest` [Source: `architecture/test-strategy-and-standards.md`]
- **Location:** `services/orchestrator/tests/unit/` [Source: `architecture/test-strategy-and-standards.md`]
- **Coverage:** Unit tests should cover the API endpoint, including success cases, invalid input, and verification of data storage. [Source: `architecture/test-strategy-and-standards.md`]

### Tasks / Subtasks

1.  **(AC: 2)** **Define Pydantic Models:**
    - In `services/orchestrator/app/models/`, create Pydantic models for `NewIncidentRequest` and `NewIncidentResponse` as defined in the OpenAPI spec.
    - Create a Pydantic model for the full `Incident` object that will be used for storage.
2.  **(AC: 5)** **Implement In-Memory Repository:**
    - In `services/orchestrator/app/core/`, create a repository or service class to handle the in-memory storage of incidents.
    - It should have a `create` method that takes a description, generates a UUID for the `incident_id`, sets the status to "pending", adds a timestamp, and stores the new incident object in a dictionary.
3.  **(AC: 1, 3, 4)** **Implement API Endpoint:**
    - In `services/orchestrator/app/api/v1/`, create a new router for incidents.
    - Implement the `POST /api/v1/incidents` endpoint.
    - Use FastAPI's dependency injection to get an instance of the in-memory repository.
    - The endpoint should take the `NewIncidentRequest` model as its body.
    - Call the repository's `create` method to store the incident.
    - Return a `202 Accepted` status code with the `NewIncidentResponse` body.
4.  **Write Unit Tests:**
    - In `services/orchestrator/tests/unit/`, create a new test file for the incidents API.
    - Write a test to verify that a `POST` request to `/api/v1/incidents` with a valid body returns a `202` status code and the correct response format.
    - Write a test to verify that the incident is correctly stored in the in-memory repository.
    - Write a test for an invalid request body to ensure a `4xx` error is returned.

### Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| _TBD_ | 1.0 | Initial Draft | _TBD_ |

### Dev Agent Record

#### Agent Model Used
_TBD_

#### Debug Log References
_TBD_

#### Completion Notes List
-

#### File List
-

### QA Results

- **Status:** Not yet reviewed
- **Date:**
- **Reviewed by:**
- **Summary:**
- **Issues Found:**
- **Recommendations:**
