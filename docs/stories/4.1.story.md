---
Epic: 4
Story: 1
Title: MCP Configuration Schema and Loading
Status: Ready for Review
---

### Story

**As a** DevOps Engineer,
**I want** to configure MCP servers via a YAML/JSON configuration file,
**so that** the SRE Orchestrator can connect to external MCP servers for enhanced diagnostic tools.

### Acceptance Criteria

1.  A configuration schema is defined for MCP server connections with fields for server URL, transport type, and optional authentication.
2.  A configuration file (e.g., `mcp_config.yaml`) is created following the schema with example MCP server configurations.
3.  A configuration loading service is implemented that parses the MCP configuration file on application startup.
4.  The configuration loader validates the schema and provides clear error messages for invalid configurations.
5.  The system gracefully handles missing MCP configuration files (optional feature).

### Dev Notes

#### Previous Story Insights
This is the first story in Epic 4, introducing MCP server support to the existing SRE Orchestrator system. The system already has successful patterns for configuration loading with `knowledge_graph.yaml` that should be followed.

#### Configuration Management
- **Existing Pattern Reference:** The system already loads `knowledge_graph.yaml` configuration in `KnowledgeGraphService` during startup [Source: services/orchestrator/src/app/main.py:13-16]
- **Configuration Location:** Follow existing pattern - place `mcp_config.yaml` in project root alongside `knowledge_graph.yaml` [Source: architecture/source-tree.md]
- **Schema Validation:** Use Pydantic models for configuration validation, following existing patterns in the codebase [Source: architecture/coding-standards.md#python-specifics]

#### File Locations
- **Configuration File:** `/mcp_config.yaml` (project root, alongside knowledge_graph.yaml) [Source: architecture/source-tree.md]
- **Service Implementation:** `services/orchestrator/src/app/services/mcp_config_service.py` [Source: architecture/source-tree.md#services-directory]
- **Pydantic Models:** `services/orchestrator/src/app/models/mcp_config.py` [Source: architecture/source-tree.md#models-directory]

#### Technical Constraints
- **Python Version:** 3.12.11 [Source: architecture/tech-stack.md]
- **Framework:** FastAPI with dependency injection pattern [Source: architecture/tech-stack.md, architecture/coding-standards.md#critical-rules]
- **Configuration Format:** YAML (following knowledge_graph.yaml pattern) [Source: architecture/tech-stack.md]
- **Validation:** Pydantic models with type hints [Source: architecture/coding-standards.md#python-specifics]

### Testing

#### Testing Standards
- **Framework:** pytest [Source: architecture/test-strategy-and-standards.md#unit-tests]
- **Location:** `services/orchestrator/tests/unit/` [Source: architecture/test-strategy-and-standards.md#unit-tests]
- **File Convention:** `test_*.py` [Source: architecture/test-strategy-and-standards.md#unit-tests]
- **Mocking Library:** `unittest.mock` [Source: architecture/test-strategy-and-standards.md#unit-tests]
- **Coverage Requirement:** 80% [Source: architecture/test-strategy-and-standards.md#unit-tests]
- **Test Pattern:** AAA (Arrange, Act, Assert) [Source: architecture/test-strategy-and-standards.md#ai-agent-requirements]

### Tasks / Subtasks

1. **Create MCP Configuration Schema (AC: 1)**
   - [x] Define Pydantic models in `services/orchestrator/src/app/models/mcp_config.py`
   - [x] Include fields: server_url, transport_type, optional authentication
   - [x] Add schema validation rules and error messages
   - [x] Follow existing model patterns with type hints and docstrings

2. **Implement Configuration Loading Service (AC: 3, 4)**
   - [x] Create `MCPConfigService` in `services/orchestrator/src/app/services/mcp_config_service.py`
   - [x] Follow existing `KnowledgeGraphService` pattern for file loading
   - [x] Implement YAML parsing with PyYAML (already available)
   - [x] Add comprehensive error handling with clear error messages
   - [x] Include validation using Pydantic models

3. **Create Example Configuration File (AC: 2, 5)**
   - [x] Create `mcp_config.yaml` in project root
   - [x] Include example MCP server configurations with different transport types
   - [x] Add comprehensive comments explaining each field
   - [x] Implement graceful handling for missing configuration file

4. **Write Unit Tests (AC: 1-5)**
   - [x] Create `test_mcp_config_service.py` in `services/orchestrator/tests/unit/`
   - [x] Test configuration schema validation (valid and invalid schemas)
   - [x] Test file loading (existing file, missing file, malformed YAML)
   - [x] Test error handling and error message clarity
   - [x] Mock file system operations using `unittest.mock`
   - [x] Achieve 80% test coverage requirement

### Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-08 | 1.0 | Initial story creation | Sarah (PO) |

### Dev Agent Record

#### Agent Model Used

#### Debug Log References

#### Completion Notes List

#### File List

- `services/orchestrator/src/app/models/mcp_config.py`
- `services/orchestrator/src/app/services/mcp_config_service.py`
- `mcp_config.yaml`
- `services/orchestrator/src/tests/unit/test_mcp_config_service.py`

### QA Results